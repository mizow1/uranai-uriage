# Implementation Plan

- [ ] 1. プロジェクト構造とコア設定の作成
  - content_payment_statement_generator ディレクトリ構造を作成
  - 設定管理クラス ConfigManager を実装
  - ファイルパス管理とバリデーション機能を追加
  - _Requirements: 1.1, 2.2_

- [ ] 2. データローダーモジュールの実装
- [ ] 2.1 CSVデータ読み込み機能の実装
  - SalesDataLoader クラスを作成
  - 月別ISP別コンテンツ別売上.csv読み込み機能を実装
  - LINE用line-contents-yyyy-mm.csv読み込み機能を実装
  - contents_mapping.csv と rate.csv の読み込み機能を実装
  - _Requirements: 1.1, 1.2, 1.3, 2.1_

- [ ] 2.2 データ統合とバリデーション機能の実装
  - 複数データソースの統合ロジックを実装
  - データ形式バリデーション機能を追加
  - 欠損データの検出と処理を実装
  - _Requirements: 1.1, 1.2, 1.3, 5.2_

- [ ] 3. Excelファイル処理モジュールの実装
- [ ] 3.1 テンプレートファイル操作機能の実装
  - ExcelProcessor クラスを作成
  - テンプレートファイルの検索と複製機能を実装
  - ファイル名生成ロジック（YYYYMM_元ファイル名）を実装
  - _Requirements: 2.2, 2.3_

- [ ] 3.2 Excelデータ書き込み機能の実装
  - S3セルへの支払日記入機能を実装
  - 23行目以降への明細データ書き込み機能を実装
  - 各列（A, D, G, M, S, Y, AC）への適切なデータ配置を実装
  - _Requirements: 3.1, 3.2, 3.3_

- [ ] 4. PDF変換モジュールの実装
- [ ] 4.1 Excel to PDF変換機能の実装
  - PDFConverter クラスを作成
  - xlwingsを使用したPDF変換機能を実装
  - PDF出力の検証機能を追加
  - _Requirements: 4.1_

- [ ] 5. メール送信モジュールの実装
- [ ] 5.1 Gmail API設定と認証機能の実装
  - EmailProcessor クラスを作成
  - Gmail API認証設定を実装
  - 認証エラーハンドリングを追加
  - _Requirements: 4.2, 4.3, 5.3_

- [ ] 5.2 メール送信と予約機能の実装
  - メール作成機能（宛先、CC、BCC、件名、本文）を実装
  - PDF添付機能を実装
  - 予約送信機能（翌月5日指定）を実装
  - _Requirements: 4.3, 4.4_

- [ ] 6. エラーハンドリングとログ機能の実装
- [ ] 6.1 包括的エラーハンドリングの実装
  - カスタム例外クラスを作成
  - ファイル関連エラーの処理を実装
  - データ処理エラーの処理を実装
  - _Requirements: 5.1, 5.2, 5.3_

- [ ] 6.2 ログ機能の実装
  - ログ設定とフォーマットを実装
  - 処理進行状況のログ出力を追加
  - エラー詳細のログ記録を実装
  - _Requirements: 5.1, 5.2, 5.3_

- [ ] 7. メインコントローラーの実装
- [ ] 7.1 統合処理フローの実装
  - MainController クラスを作成
  - 全体的な処理フローを統合
  - 年月指定インターフェースを実装
  - _Requirements: 1.1_

- [ ] 7.2 バッチ処理機能の実装
  - 複数コンテンツの一括処理機能を実装
  - 処理進捗の表示機能を追加
  - 処理結果のサマリー出力を実装
  - _Requirements: 1.1, 2.1, 3.1_

- [ ] 8. テスト実装
- [ ] 8.1 ユニットテストの作成
  - 各クラスの個別機能テストを作成
  - データ変換ロジックのテストを実装
  - エラーハンドリングのテストを追加
  - _Requirements: 全要件のテスト_

- [ ] 8.2 統合テストの作成
  - データフロー全体のテストを作成
  - ファイル操作の統合テストを実装
  - モックを使用したメール送信テストを作成
  - _Requirements: 全要件の統合テスト_

- [ ] 9. 設定ファイルとドキュメントの作成
- [ ] 9.1 設定ファイルの作成
  - requirements.txt を更新
  - 設定用JSONファイルを作成
  - Gmail API認証設定ガイドを作成
  - _Requirements: システム設定_

- [ ] 9.2 実行スクリプトとドキュメントの作成
  - メイン実行スクリプトを作成
  - 使用方法のドキュメントを作成
  - トラブルシューティングガイドを作成
  - _Requirements: システム利用_